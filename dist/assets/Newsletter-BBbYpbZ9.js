import{r as t,d as c,j as e}from"./index-Bh_G82eR.js";import{l as h}from"./logger-kjsKaDI_.js";import{n as f}from"./index-B7n9UX3I.js";import{e as j,x as P,n as y,Y as B}from"./index.esm-BGr2I2xK.js";import{S as N}from"./sweetalert2.esm.all-B3GDCxSY.js";import"./iconBase-D0Fi-Wjo.js";function T(){var x,m,b;const[o,w]=t.useState([]),[a,v]=t.useState(null),[k,S]=t.useState(!0),[r,l]=t.useState({subject:"",message:""}),[n,d]=t.useState(!1);t.useEffect(()=>{C()},[]);const C=async()=>{try{const[s,g]=await Promise.all([c.get("/admin/marketing/newsletter/subscribers"),c.get("/admin/marketing/newsletter/stats")]);w(s.data.data),v(g.data.data)}catch(s){h.error("Failed to fetch newsletter data:",s),f.error("Failed to load newsletter data")}finally{S(!1)}},F=async s=>{var p,u;if(s.preventDefault(),!!(await N.fire({title:"Send Campaign?",text:`You are about to send an email to ${o.length} subscribers. This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3b82f6",confirmButtonText:"Yes, send it!"})).isConfirmed){d(!0);try{(await c.post("/admin/marketing/newsletter/campaign",r)).data.success&&(N.fire("Sent!","Campaign has been queued for delivery.","success"),l({subject:"",message:""}))}catch(i){h.error("Failed to send campaign:",i),f.error(((u=(p=i.response)==null?void 0:p.data)==null?void 0:u.message)||"Failed to send campaign")}finally{d(!1)}}};return k?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Newsletter Management"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Manage marketing campaigns and subscriber base"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"bg-white px-4 py-2 rounded-xl shadow-sm border border-gray-100 flex items-center gap-2",children:[e.jsx(j,{className:"text-blue-500"}),e.jsxs("span",{className:"text-xs font-black uppercase tracking-widest",children:[(a==null?void 0:a.total)||0," Total"]})]}),e.jsxs("div",{className:"bg-white px-4 py-2 rounded-xl shadow-sm border border-gray-100 flex items-center gap-2",children:[e.jsx(P,{className:"text-green-500"}),e.jsxs("span",{className:"text-xs font-black uppercase tracking-widest",children:[(a==null?void 0:a.active)||0," Active"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-50 bg-gray-50/50 flex items-center gap-2",children:[e.jsx(y,{className:"text-blue-600"}),e.jsx("h2",{className:"text-sm font-black text-gray-800 uppercase tracking-widest",children:"Send New Campaign"})]}),e.jsxs("form",{onSubmit:F,className:"p-6 space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1",children:"Subject Line"}),e.jsx("input",{type:"text",value:r.subject,onChange:s=>l({...r,subject:s.target.value}),placeholder:"Enter email subject...",className:"w-full px-4 py-3 rounded-xl border border-gray-100 focus:ring-2 focus:ring-blue-500/20 outline-none transition-all text-sm font-medium bg-gray-50/50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1",children:"Message Content (HTML Supported)"}),e.jsx("textarea",{value:r.message,onChange:s=>l({...r,message:s.target.value}),placeholder:"Write your campaign message...",className:"w-full px-4 py-3 rounded-xl border border-gray-100 focus:ring-2 focus:ring-blue-500/20 outline-none transition-all h-64 font-mono text-xs resize-none bg-gray-50/50",required:!0})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs("button",{type:"submit",disabled:n,className:"flex items-center gap-2 bg-blue-600 text-white px-8 py-3 rounded-xl shadow-lg shadow-blue-200 hover:shadow-xl hover:bg-blue-700 transition-all font-black uppercase tracking-widest text-[10px] disabled:opacity-50",children:[n?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(y,{}),n?"Processing...":"Blast Campaign"]})})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 space-y-5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-800 font-bold border-b border-gray-50 pb-3",children:[e.jsx(B,{className:"text-blue-600"}),e.jsx("h3",{className:"text-xs font-black uppercase tracking-widest",children:"Category Interests"})]}),e.jsx("div",{className:"space-y-5",children:[{label:"New Arrivals",count:((x=a==null?void 0:a.byPreference)==null?void 0:x.newArrivals)||0,color:"bg-blue-500"},{label:"Promotions",count:((m=a==null?void 0:a.byPreference)==null?void 0:m.promotions)||0,color:"bg-indigo-500"},{label:"Blog Posts",count:((b=a==null?void 0:a.byPreference)==null?void 0:b.blogPosts)||0,color:"bg-emerald-500"}].map(s=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between text-[10px] font-black uppercase tracking-tight",children:[e.jsx("span",{className:"text-gray-400",children:s.label}),e.jsx("span",{className:"text-gray-900",children:s.count})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-50 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${s.color}`,style:{width:`${Math.min(100,s.count/((a==null?void 0:a.total)||1)*100)}%`}})})]},s.label))})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-800 font-bold border-b border-gray-50 pb-3 mb-4",children:[e.jsx(j,{className:"text-blue-600"}),e.jsx("h3",{className:"text-xs font-black uppercase tracking-widest",children:"Recent Subs"})]}),e.jsx("div",{className:"space-y-4",children:o.slice(0,5).map(s=>e.jsxs("div",{className:"flex flex-col border-b border-gray-50 last:border-0 pb-3 last:pb-0",children:[e.jsx("span",{className:"text-xs font-bold text-gray-800 truncate",children:s.email}),e.jsxs("span",{className:"text-[10px] text-gray-400 font-bold uppercase mt-1 tracking-tight",children:["Joined ",new Date(s.subscribedAt).toLocaleDateString()]})]},s._id))})]})]})]})]})}export{T as default};
