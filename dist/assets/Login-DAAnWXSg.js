import{r,j as e,d as k,a as P,u as V,L as D}from"./index-Bh_G82eR.js";import{s as L,a as j,b as M,c as A}from"./swal-Bzj92f0x.js";import{m as T}from"./proxy-B-BKHVQZ.js";import"./sweetalert2.esm.all-B3GDCxSY.js";function R({userId:x,onSuccess:v,onCancel:h}){const[c,b]=r.useState(""),[i,d]=r.useState(!1),[g,u]=r.useState(""),[p,m]=r.useState(null),y=s=>{const n=s.target.value.replace(/\D/g,"").substring(0,4);b(n),u("")},N=s=>{var t;const a=`; ${document.cookie}`.split(`; ${s}=`);if(a.length===2)return(t=a.pop())==null?void 0:t.split(";").shift()};r.useEffect(()=>{(async()=>{try{await k.get("/auth/me")}catch{}})()},[]);const w=async()=>{var s,n;if(u(""),c.length!==4){u("Please enter a 4-digit code");return}d(!0);try{const a=N("XSRF-TOKEN"),t=await k.post("/auth/verify-ip",{userId:x,code:c},{headers:{"X-XSRF-TOKEN":a}});if(t.data.success){const f=t.data.token||((s=t.data.data)==null?void 0:s.accessToken);f&&(sessionStorage.setItem("token",f),sessionStorage.setItem("is_logged_in","true")),L("IP verified successfully","Success"),v(t.data.data)}}catch(a){const t=(n=a.response)==null?void 0:n.data,f=(t==null?void 0:t.message)||"Verification failed";u(f),typeof(t==null?void 0:t.attemptsLeft)=="number"&&m(t.attemptsLeft),(t==null?void 0:t.attemptsLeft)===0&&j("Maximum verification attempts exceeded. Please request a new code.","Too Many Attempts")}finally{d(!1)}},S=async()=>{var s,n;d(!0),u("");try{(await k.post("/auth/resend-verification",{userId:x})).data.success&&(L("New code sent to your email","Success"),b(""),m(null))}catch(a){const t=((n=(s=a.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to resend code";j(t,"Error")}finally{d(!1)}},l=s=>{s.key==="Enter"&&c.length===4&&w()};return e.jsx("div",{className:"fixed inset-0 bg-gray-100 flex items-center justify-center z-[9999] p-4",children:e.jsxs(T.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("span",{className:"text-4xl",children:"ðŸ›¡ï¸"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Security Verification"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"We detected a login from a new IP address. Please enter the verification code sent to your email."})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-center",children:"Verification Code"}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:c,onChange:y,onKeyPress:l,placeholder:"0000",maxLength:4,className:"w-full px-4 py-4 text-center text-3xl font-bold tracking-[1em] rounded-xl border-2 border-gray-200 focus:border-blue-600 focus:ring-4 focus:ring-blue-50 outline-none transition-all placeholder:tracking-normal",autoFocus:!0,disabled:i}),p!==null&&e.jsxs("p",{className:"text-sm text-orange-600 mt-3 text-center font-medium",children:[p," attempt",p===1?"":"s"," remaining"]})]}),g&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-xl flex items-center gap-3",children:[e.jsx("span",{className:"text-red-500",children:"âš ï¸"}),e.jsx("p",{className:"text-sm text-red-600 font-medium",children:g})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:w,disabled:i||c.length!==4,className:"w-full py-4 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition transform active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-blue-600/20",children:i?"Verifying...":"Verify Access"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{onClick:S,disabled:i,className:"w-full py-3 text-sm text-gray-600 font-medium bg-gray-50 rounded-lg hover:bg-gray-100 transition disabled:opacity-50",children:"Resend Code"}),e.jsx("button",{onClick:h,disabled:i,className:"w-full py-3 text-sm text-gray-600 font-medium bg-gray-50 rounded-lg hover:bg-gray-100 transition",children:"Back to Login"})]})]})]})})}function _(){const[x,v]=r.useState(""),[h,c]=r.useState(""),[b,i]=r.useState(!1),[d,g]=r.useState(null),{login:u,isAuthenticated:p}=P(),m=V();r.useEffect(()=>{p&&m("/dashboard",{replace:!0})},[p,m]);const y=()=>{A(),L("Welcome back!","Login Successful"),setTimeout(()=>m("/"),1e3)},N=async l=>{var n,a,t,f,F,C,E;if(l.preventDefault(),!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x)){j("Please enter a valid email address.","Invalid Email");return}M("Logging in...");try{const o=await u({email:x,password:h});if(o&&o.requires2FA){A(),m("/auth/2fa",{state:{tempToken:o.tempToken}});return}y()}catch(o){if(A(),((n=o.response)==null?void 0:n.status)===403&&((a=o.response.data)!=null&&a.requiresIPVerification)){g(o.response.data.userId),i(!0);return}let I=((f=(t=o.response)==null?void 0:t.data)==null?void 0:f.message)||"Failed to login. Check credentials.";((E=(C=(F=o.response)==null?void 0:F.data)==null?void 0:C.data)==null?void 0:E.attemptsLeft)!==void 0&&(I+=` (${o.response.data.data.attemptsLeft} attempts remaining)`),j(I,"Login Failed")}},w=l=>{i(!1),g(null),P.setState({admin:l,isAuthenticated:!0,isLoading:!1}),y()},S=()=>{i(!1),g(null)};return e.jsxs("div",{className:"min-h-screen bg-[#F5F5DC] flex items-center justify-center p-4",children:[e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl w-full max-w-md px-8 py-8 relative z-10 mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-[#4A3728] mb-2",children:"Welcome Back"}),e.jsx("p",{className:"text-[#4A3728]/70 text-sm",children:"ADMIN LOGIN"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-semibold text-[#4A3728]",children:"Email Address"}),e.jsx("input",{type:"email",value:x,onChange:l=>v(l.target.value),required:!0,className:"block w-full px-4 py-3.5 bg-[#F5F5DC]/50 border border-transparent focus:bg-white focus:border-[#D4AF37] rounded-xl focus:ring-2 focus:ring-[#D4AF37]/20 transition-all outline-none text-[#4A3728] placeholder-gray-700 font-medium",placeholder:"name@example.com"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-semibold text-[#4A3728]",children:"Password"}),e.jsx(D,{to:"/forgot-password",title:"Forgot Password?",className:"text-sm font-medium text-[#D4AF37] hover:text-[#B3902E] transition-colors",children:"Forgot Password?"})]}),e.jsx("input",{type:"password",value:h,onChange:l=>c(l.target.value),required:!0,className:"block w-full px-4 py-3.5 bg-[#F5F5DC]/50 border border-transparent focus:bg-white focus:border-[#D4AF37] rounded-xl focus:ring-2 focus:ring-[#D4AF37]/20 transition-all outline-none text-[#4A3728] placeholder-gray-700 font-medium",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsx("button",{type:"submit",className:"w-full bg-[#D8C3A5] hover:bg-[#D4AF37] text-[#4A3728] py-3.5 rounded-xl font-bold shadow-sm hover:shadow-md transition-all duration-200 text-base",children:"Sign In"})]})]}),b&&d&&e.jsx(R,{userId:d,onSuccess:w,onCancel:S})]})}export{_ as default};
