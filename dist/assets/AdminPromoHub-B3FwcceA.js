import{r as i,d as c,j as e}from"./index-Bh_G82eR.js";import{k as b,c as N,d as A,l as f,m,n as S}from"./index.esm-DdX2Oo8i.js";import{n as o}from"./index-B7n9UX3I.js";import{l as C}from"./logger-kjsKaDI_.js";import{S as $}from"./sweetalert2.esm.all-B3GDCxSY.js";import"./iconBase-D0Fi-Wjo.js";const O=()=>{const[k,y]=i.useState([]),[j,w]=i.useState([]),[l,x]=i.useState(!0),[d,g]=i.useState("discounts"),n=i.useCallback(async()=>{const t=new AbortController;x(!0);try{const[a,s]=await Promise.all([c.get("/admin/marketing/discount-codes",{signal:t.signal}),c.get("/admin/marketing/flash-sales",{signal:t.signal})]);a.data.success&&y(a.data.data.data),s.data.success&&w(s.data.data.data)}catch(a){a.name!=="CanceledError"&&(C.error("Failed to fetch promo hub data:",a),o.error("Failed to load marketing oversight data"))}finally{x(!1)}return()=>t.abort()},[]);i.useEffect(()=>{n()},[n]);const p=async(t,a,s,v)=>{var u;const{value:h}=await $.fire({title:`${s?"Deactivate":"Activate"} Promotion?`,text:`Action will be logged for oversight. Target: ${v}`,input:"textarea",inputPlaceholder:"Mandatory reason for kill-switch toggle...",inputAttributes:{"aria-label":"Reason for toggle"},showCancelButton:!0,confirmButtonColor:s?"#ef4444":"#10b981",confirmButtonText:`Yes, ${s?"Deactivate":"Activate"}`,inputValidator:r=>{if(!r)return"You must provide a reason for this audit-sensitive action!"}});if(h)try{const r=t==="discount"?`/admin/marketing/discount-codes/${a}/toggle`:`/admin/marketing/flash-sales/${a}/toggle`;(await c.patch(r,{reason:h,isActive:!s})).data.success&&(o.success("Promotion status updated"),window.location.reload())}catch(r){o.error(((u=r==null?void 0:r.normalized)==null?void 0:u.message)||"Toggle failed")}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-black text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-pink-50 dark:bg-pink-900/20 flex items-center justify-center text-pink-500",children:e.jsx(b,{size:20})}),"Marketing Oversight Hub"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1 text-sm",children:"Deterministic kill-switches and abuse monitoring."})]}),e.jsxs("button",{onClick:n,disabled:l,className:"flex items-center gap-2 px-4 py-2 bg-gray-900 dark:bg-white text-white dark:text-black rounded-xl font-bold text-xs uppercase tracking-widest transition-all hover:scale-105 active:scale-95 disabled:opacity-50",children:[e.jsx(N,{className:l?"animate-spin":""}),"Refresh"]})]}),e.jsxs("div",{className:"flex gap-2 p-1 bg-gray-100 dark:bg-white/5 rounded-xl w-fit",children:[e.jsx("button",{onClick:()=>g("discounts"),className:`px-4 py-2 rounded-lg font-bold text-[10px] uppercase tracking-widest transition-all ${d==="discounts"?"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Discount Codes"}),e.jsx("button",{onClick:()=>g("flash-sales"),className:`px-4 py-2 rounded-lg font-bold text-[10px] uppercase tracking-widest transition-all ${d==="flash-sales"?"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Flash Sales"})]}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-sm border border-gray-100 dark:border-white/5 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50/50 dark:bg-black/20 border-b border-gray-100 dark:border-white/5",children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Promotion"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Store"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Performance"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Risk"}),e.jsx("th",{className:"px-6 py-4 text-right text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-white/5",children:l?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-10 text-center text-gray-400 text-xs font-bold uppercase tracking-widest animate-pulse",children:"Scanning Platform..."})}):d==="discounts"?k.map(t=>{var a;return e.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${t.isActive?"bg-green-50 text-green-500":"bg-red-50 text-red-500"}`,children:e.jsx(b,{size:14})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900 dark:text-white text-sm",children:t.code}),e.jsx("p",{className:"text-[9px] text-gray-400 font-bold uppercase",children:t.type==="percentage"?`${t.value}% OFF`:`â‚¦${t.value} OFF`})]})]})}),e.jsx("td",{className:"px-6 py-4 font-bold text-gray-600 dark:text-gray-400 text-xs",children:((a=t.storeId)==null?void 0:a.name)||"N/A"}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("p",{className:"text-[11px] font-black text-gray-900 dark:text-white",children:[t.usageCount," Uses"]}),e.jsx("div",{className:"w-16 h-1 bg-gray-100 dark:bg-white/5 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${Math.min(t.usageCount/(t.usageLimit||100)*100,100)}%`}})})]}),e.jsx("td",{className:"px-6 py-4",children:t.riskScore!=="Low"?e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded-full text-[8px] font-black uppercase tracking-widest border w-fit ${t.riskScore==="Critical"?"bg-red-100 text-red-700 border-red-200":t.riskScore==="High"?"bg-red-50 text-red-600 border-red-100":"bg-orange-50 text-orange-600 border-orange-100"}`,children:[e.jsx(A,{size:10}),t.riskScore," Risk"]}):e.jsx("span",{className:"text-[9px] font-black text-green-500 uppercase tracking-widest",children:"Safe"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>p("discount",t.id,t.isActive,t.code),className:`p-2 rounded-lg transition-all ${t.isActive?"text-green-500 hover:bg-green-50":"text-red-500 hover:bg-red-50"}`,children:t.isActive?e.jsx(f,{size:22}):e.jsx(m,{size:22})})})]},t.id)}):j.map(t=>e.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${t.isActive?"bg-orange-50 text-orange-500":"bg-red-50 text-red-500"}`,children:e.jsx(S,{size:14})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900 dark:text-white text-sm truncate max-w-[150px]",children:t.productName}),e.jsx("p",{className:"text-[9px] text-gray-400 font-bold uppercase",children:"Flash Sale"})]})]})}),e.jsx("td",{className:"px-6 py-4 font-bold text-gray-600 dark:text-gray-400 text-xs",children:t.storeName}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("p",{className:"text-[11px] font-black text-gray-900 dark:text-white",children:[t.soldCount," / ",t.maxQuantity," Sold"]}),e.jsx("div",{className:"w-16 h-1 bg-gray-100 dark:bg-white/5 rounded-full mt-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 rounded-full",style:{width:`${t.soldCount/t.maxQuantity*100}%`}})})]}),e.jsx("td",{className:"px-6 py-4",children:t.riskScore==="Peak"?e.jsx("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-[8px] font-black uppercase tracking-widest border border-orange-100 bg-orange-50 text-orange-600 w-fit",children:"Peak Use"}):e.jsx("span",{className:"text-[9px] font-black text-green-500 uppercase tracking-widest",children:"Safe"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>p("flash-sale",t.id,t.isActive,t.productName),className:`p-2 rounded-lg transition-all ${t.isActive?"text-green-500 hover:bg-green-50":"text-red-500 hover:bg-red-50"}`,children:t.isActive?e.jsx(f,{size:22}):e.jsx(m,{size:22})})})]},t.id))})]})})})]})};export{O as default};
