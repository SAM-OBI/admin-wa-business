import{r as u,j as e,a as q,d as j}from"./index-Bh_G82eR.js";import{a as w}from"./admin.service-DANvCZDH.js";import{W as L,G as Q,j as T,x as W,X as N,z as R}from"./index.esm-BGr2I2xK.js";import{A as M}from"./index-DtRD-HeV.js";import{m as I}from"./proxy-B-BKHVQZ.js";import"./iconBase-D0Fi-Wjo.js";const O=["What was the name of your first pet?","What is your mother's maiden name?","What city were you born in?","What was the name of your first school?","What is your favorite movie?","What was your childhood nickname?","What is the name of your favorite teacher?","What was the make of your first car?"];function U({isOpen:o,onClose:b,onSubmit:a}){const[n,d]=u.useState([{question:"",answer:""},{question:"",answer:""},{question:"",answer:""}]),c=(i,r)=>{const l=[...n];l[i].question=r,d(l)},s=(i,r)=>{const l=[...n];l[i].answer=r,d(l)},g=n.every(i=>i.question&&i.answer.trim().length>=2);return o?e.jsx(M,{children:e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs(I.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex items-center justify-between bg-[#F5F5DC]/30",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[#4A3728]",children:[e.jsx(L,{className:"text-xl text-[#D4AF37]"}),e.jsx("h3",{className:"font-bold text-lg",children:"Security Questions"})]}),e.jsx("button",{onClick:b,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Q,{className:"text-gray-400"})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 bg-blue-50 p-3 rounded-lg border border-blue-100",children:"Please set 3 security questions. These will be used to recover your account if you lose your 2FA device."}),n.map((i,r)=>e.jsxs("div",{className:"space-y-3 p-4 border border-gray-100 rounded-xl bg-gray-50/50",children:[e.jsxs("label",{className:"block text-sm font-bold text-[#4A3728]",children:["Question ",r+1]}),e.jsxs("select",{value:i.question,onChange:l=>c(r,l.target.value),className:"w-full px-4 py-2 bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#D4AF37]/20 outline-none text-sm",children:[e.jsx("option",{value:"",children:"Select a question..."}),O.map(l=>e.jsx("option",{value:l,disabled:n.some((y,p)=>y.question===l&&p!==r),children:l},l))]}),e.jsx("input",{type:"text",value:i.answer,onChange:l=>s(r,l.target.value),placeholder:"Your answer",className:"w-full px-4 py-2 bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#D4AF37]/20 outline-none text-sm"})]},r))]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-end gap-3",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{onClick:()=>a(n),disabled:!g,className:"px-6 py-2 bg-[#D4AF37] text-white rounded-lg font-bold hover:bg-[#B3902E] transition-all disabled:opacity-50 text-sm shadow-sm",children:"Complete Setup"})]})]})})}):null}const H=()=>{const[o,b]=u.useState({attempts:[],sessions:[]}),[a,n]=u.useState(!0),d=async()=>{try{const s=await j.get("/auth/login-history");b(s.data.data||{attempts:[],sessions:[]})}catch(s){console.error("Failed to fetch login history:",s)}finally{n(!1)}};u.useEffect(()=>{d()},[]);const c=async s=>{try{await j.post(`/auth/sessions/${s}/revoke`),d()}catch{console.error("Failed to logout device")}};return a?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loading security data..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(N,{className:"text-blue-600"})," Active Devices"]}),e.jsxs("div",{className:"space-y-3",children:[o.sessions.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50/30 rounded-lg border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full text-blue-600",children:e.jsx(N,{})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-gray-800",children:[s.device,s.isActive&&e.jsx("span",{className:"ml-2 text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded-full uppercase tracking-wider",children:"Active Now"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.ipAddress," • ",new Date(s.loginTime).toLocaleString()]})]})]}),e.jsx("button",{onClick:()=>c(s.id),className:"text-xs font-semibold text-red-600 hover:text-red-700 bg-red-50 hover:bg-red-100 px-3 py-1.5 rounded-lg transition",children:"Logout"})]},s.id)),o.sessions.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4 italic",children:"No active sessions found."})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(R,{className:"text-gray-600"})," Recent Activity"]}),e.jsxs("div",{className:"space-y-3",children:[o.attempts.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50/50 rounded-lg border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-gray-400",children:e.jsx(N,{})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700",children:s.device}),e.jsx("p",{className:"text-[10px] text-gray-400",children:new Date(s.loginTime).toLocaleString()})]})]}),e.jsx("span",{className:"text-[10px] font-mono text-gray-300",children:s.ipAddress})]},s.id)),o.attempts.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4 italic",children:"No recent activity detected."})]})]})]})};function B(){const{admin:o,checkAuth:b}=q(),[a,n]=u.useState({name:(o==null?void 0:o.name)||"",email:(o==null?void 0:o.email)||"",password:"",confirmPassword:""}),[d,c]=u.useState(!1),[s,g]=u.useState(null),[i,r]=u.useState("idle"),[l,y]=u.useState(""),[p,f]=u.useState(""),[C,S]=u.useState([]),[A,v]=u.useState(!1),F=async()=>{var t,x,h;c(!0);try{const m=await w.setup2FA();(t=m.data)!=null&&t.qrCodeUrl&&(y(m.data.qrCodeUrl),r("qr"))}catch(m){g({type:"error",text:((h=(x=m.response)==null?void 0:x.data)==null?void 0:h.message)||"Failed to setup 2FA"})}finally{c(!1)}},k=()=>{p.length===6&&v(!0)},D=async t=>{var x,h;c(!0);try{const m=await j.post("/auth/2fa/verify",{token:p,securityQuestions:t});S(m.data.data.recoveryCodes),r("success"),v(!1),await b()}catch(m){g({type:"error",text:((h=(x=m.response)==null?void 0:x.data)==null?void 0:h.message)||"Verification failed"})}finally{c(!1)}},P=async()=>{var t,x;c(!0);try{await w.disable2FA(p),g({type:"success",text:"Two-Factor Authentication Disabled"}),r("idle"),y(""),f(""),await b()}catch(h){g({type:"error",text:((x=(t=h.response)==null?void 0:t.data)==null?void 0:x.message)||"Invalid code"})}finally{c(!1)}},E=async t=>{var x,h;if(t.preventDefault(),c(!0),g(null),a.password&&a.password!==a.confirmPassword){g({type:"error",text:"Passwords do not match"}),c(!1);return}try{await j.put("/users/me",{name:a.name,email:a.email,...a.password?{password:a.password}:{}}),g({type:"success",text:"Profile updated successfully"}),await b(),n(m=>({...m,password:"",confirmPassword:""}))}catch(m){g({type:"error",text:((h=(x=m.response)==null?void 0:x.data)==null?void 0:h.message)||"Failed to update profile"})}finally{c(!1)}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Settings"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Manage your account preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 h-fit",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Profile Information"}),s&&e.jsx("div",{className:`p-4 rounded-lg mb-6 ${s.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:s.text}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>n({...a,name:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",value:a.email,onChange:t=>n({...a,email:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Change Password (Optional)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),e.jsx("input",{type:"password",value:a.password,onChange:t=>n({...a,password:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Leave blank to keep current"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:a.confirmPassword,onChange:t=>n({...a,confirmPassword:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Confirm new password"})]})]})]}),e.jsx("div",{className:"pt-6 flex justify-end",children:e.jsx("button",{type:"submit",disabled:d,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 font-medium",children:d?"Saving...":"Save Changes"})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(T,{})," Two-Factor Authentication"]}),o!=null&&o.isTwoFactorEnabled?e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 text-green-600 mb-4",children:e.jsx("span",{className:"font-bold",children:"✓ 2FA is Enabled"})}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Your account is secured with two-factor authentication. You will be required to enter a code from your authenticator app when logging in."}),i!=="disabling"?e.jsx("button",{onClick:()=>r("disabling"),className:"px-4 py-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 text-sm font-medium transition",children:"Disable 2FA"}):e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Confirm to Disable"}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Enter the code from your app to confirm disabling 2FA."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"000 000",value:p,onChange:t=>f(t.target.value.replace(/\D/g,"").slice(0,6)),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-center tracking-widest font-mono",maxLength:6}),e.jsx("button",{onClick:P,disabled:d||p.length!==6,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 text-sm font-medium",children:d?"...":"Confirm"}),e.jsx("button",{onClick:()=>{r("idle"),f("")},className:"px-3 py-2 text-gray-500 hover:text-gray-700",children:"Cancel"})]})]})]}):e.jsxs("div",{children:[i==="idle"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Add an extra layer of security to your account by enabling two-factor authentication."}),e.jsx("button",{onClick:F,disabled:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:d?"Loading...":"Enable 2FA"})]}),i==="qr"&&l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center p-4 bg-gray-50 rounded-lg border border-gray-100",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Scan QR Code"}),e.jsx("img",{src:l,alt:"2FA QR Code",className:"w-40 h-40 mb-4 border border-white shadow-sm"}),e.jsx("p",{className:"text-xs text-gray-500 text-center max-w-xs mb-4",children:"Use Google Authenticator or Authy App to scan this code."}),e.jsxs("div",{className:"w-full max-w-xs",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Enter 6-digit Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"000 000",value:p,onChange:t=>f(t.target.value.replace(/\D/g,"").slice(0,6)),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-center tracking-widest font-mono focus:ring-2 focus:ring-blue-500 outline-none",maxLength:6}),e.jsx("button",{onClick:k,disabled:d||p.length!==6,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm font-medium",children:"Next"})]})]})]}),e.jsx("button",{onClick:()=>{r("idle"),y(""),f("")},className:"text-gray-500 text-sm hover:underline",children:"Cancel Setup"})]}),i==="success"&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-6 text-center",children:[e.jsx(W,{className:"text-green-500 text-5xl mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-green-800 mb-2",children:"2FA Enabled!"}),e.jsx("p",{className:"text-sm text-green-700 mb-6",children:"Save these recovery codes safely."}),e.jsx("div",{className:"bg-white p-3 rounded-lg border border-green-200 grid grid-cols-2 gap-2 font-mono text-xs mb-6",children:C.map((t,x)=>e.jsx("div",{className:"p-1",children:t},x))}),e.jsx("button",{onClick:()=>r("idle"),className:"w-full py-2 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 transition shadow-sm",children:"Done"})]})]})]}),e.jsx(U,{isOpen:A,onClose:()=>v(!1),onSubmit:D}),e.jsx(H,{})]})]})]})}export{B as default};
