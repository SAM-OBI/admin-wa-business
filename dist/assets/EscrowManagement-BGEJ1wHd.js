import{r,d as h,j as e}from"./index-Bh_G82eR.js";import{F as w,x as R,K as F,m as T}from"./index.esm-BGr2I2xK.js";import{S as c}from"./sweetalert2.esm.all-B3GDCxSY.js";import"./iconBase-D0Fi-Wjo.js";function _(){const[t,N]=r.useState(null),[v,k]=r.useState([]),[f,S]=r.useState([]),[C,y]=r.useState(!0),[o,g]=r.useState("overview"),[n,E]=r.useState("all"),u=r.useCallback(async()=>{try{const s=await h.get("/admin/escrow/dashboard");s.data.success&&N(s.data.data)}catch(s){console.error("Failed to fetch dashboard:",s)}},[]),b=r.useCallback(async()=>{try{const s={limit:20};n!=="all"&&(s.status=n);const l=await h.get("/admin/escrow/by-vendor",{params:s});l.data.success&&k(l.data.data.vendors)}catch(s){console.error("Failed to fetch vendors:",s)}},[n]),p=r.useCallback(async()=>{y(!0);try{const s={limit:50};n!=="all"&&(s.status=n);const l=await h.get("/admin/escrow/transactions",{params:s});l.data.success&&S(l.data.data.transactions)}catch(s){console.error("Failed to fetch transactions:",s)}finally{y(!1)}},[n]);r.useEffect(()=>{u(),b(),p()},[u,b,p]);const j=async(s,l)=>{var i,x;const{value:d}=await c.fire({title:"Force Release Escrow",html:`
        <p class="mb-4">Order: <strong>${l}</strong></p>
        <textarea id="reason" class="swal2-textarea w-full" placeholder="Reason for manual release..." rows="4" required></textarea>
      `,showCancelButton:!0,confirmButtonColor:"#3b82f6",confirmButtonText:"Release Escrow",preConfirm:()=>{var m;const a=(m=document.getElementById("reason"))==null?void 0:m.value;return a||(c.showValidationMessage("Please provide a reason"),!1)}});if(d)try{const a=await h.post(`/admin/escrow/${s}/release`,{reason:d});a.data.success&&(c.fire("Released!",`Escrow released: ₦${a.data.data.amountReleased.toLocaleString()}`,"success"),u(),b(),p())}catch(a){c.fire("Error",((x=(i=a.response)==null?void 0:i.data)==null?void 0:x.message)||"Failed to release escrow","error")}},L=async(s,l)=>{var i,x;const{value:d}=await c.fire({title:"Hold Escrow",html:`
        <p class="mb-4">Order: <strong>${l}</strong></p>
        <p class="text-sm text-orange-600 mb-4">This will prevent automatic escrow release</p>
        <textarea id="reason" class="swal2-textarea w-full" placeholder="Reason for hold..." rows="4" required></textarea>
      `,showCancelButton:!0,confirmButtonColor:"#f59e0b",confirmButtonText:"Hold Escrow",preConfirm:()=>{var m;const a=(m=document.getElementById("reason"))==null?void 0:m.value;return a||(c.showValidationMessage("Please provide a reason"),!1)}});if(d)try{(await h.post(`/admin/escrow/${s}/hold`,{reason:d})).data.success&&(c.fire("Hold Applied!","Escrow will not auto-release","success"),p())}catch(a){c.fire("Error",((x=(i=a.response)==null?void 0:i.data)==null?void 0:x.message)||"Failed to hold escrow","error")}};return C&&!t?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(w,{className:"text-blue-600"}),"Escrow Management"]}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Platform-wide escrow oversight and fund management"})]}),t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-100 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:"Total Locked"}),e.jsx(w,{className:"text-orange-500",size:18})]}),e.jsxs("div",{className:"text-2xl font-black text-gray-900",children:["₦",t.totalLocked.toLocaleString()]}),e.jsxs("p",{className:"text-[10px] text-gray-400 font-medium mt-1",children:[t.pendingRelease," pending release"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-100 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:"Total Released"}),e.jsx(R,{className:"text-green-500",size:18})]}),e.jsxs("div",{className:"text-2xl font-black text-gray-900",children:["₦",t.totalReleased.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-100 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:"Disputed"}),e.jsx(F,{className:"text-red-500",size:18})]}),e.jsxs("div",{className:"text-2xl font-black text-gray-900",children:["₦",t.totalDisputed.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-100 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:"Total Managed"}),e.jsx(T,{className:"text-blue-500",size:18})]}),e.jsxs("div",{className:"text-2xl font-black text-gray-900",children:["₦",(t.totalLocked+t.totalReleased).toLocaleString()]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-gray-100",children:[e.jsx("button",{onClick:()=>g("overview"),className:`px-6 py-4 font-bold text-xs uppercase tracking-widest transition-all ${o==="overview"?"border-b-2 border-blue-600 text-blue-600":"text-gray-400 hover:text-gray-600"}`,children:"Overview"}),e.jsx("button",{onClick:()=>g("vendors"),className:`px-6 py-4 font-bold text-xs uppercase tracking-widest transition-all ${o==="vendors"?"border-b-2 border-blue-600 text-blue-600":"text-gray-400 hover:text-gray-600"}`,children:"By Vendor"}),e.jsx("button",{onClick:()=>g("transactions"),className:`px-6 py-4 font-bold text-xs uppercase tracking-widest transition-all ${o==="transactions"?"border-b-2 border-blue-600 text-blue-600":"text-gray-400 hover:text-gray-600"}`,children:"Transactions"})]}),e.jsxs("div",{className:"p-6",children:[o==="overview"&&t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-800 uppercase tracking-widest flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-blue-600 rounded-full"}),"Status Breakdown"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:t.byStatus.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-800 capitalize text-sm",children:s._id||"Unknown"}),e.jsxs("div",{className:"text-[10px] text-gray-400 font-bold uppercase",children:[s.count," orders"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-black text-gray-900",children:["₦",s.amount.toLocaleString()]})})]},s._id))})]}),o==="vendors"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-sm font-bold text-gray-800 uppercase tracking-widest flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-blue-600 rounded-full"}),"Escrow by Vendor"]})}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-100",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-[10px] font-black uppercase text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3",children:"Locked"}),e.jsx("th",{className:"px-4 py-3",children:"Released"}),e.jsx("th",{className:"px-4 py-3",children:"Orders"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:v.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-800",children:s.vendorName}),e.jsx("div",{className:"text-[10px] text-gray-400",children:s.vendorEmail})]})}),e.jsxs("td",{className:"px-4 py-3 font-black text-orange-600 text-sm",children:["₦",s.totalLocked.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 font-black text-green-600 text-sm",children:["₦",s.totalReleased.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-gray-600",children:s.orderCount})]},s.vendorId))})]})})]}),o==="transactions"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-800 uppercase tracking-widest flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-blue-600 rounded-full"}),"Escrow Transactions"]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","held","released"].map(s=>e.jsx("button",{onClick:()=>E(s),className:`px-3 py-1.5 text-[10px] font-black uppercase tracking-widest rounded-lg transition-all ${n===s?"bg-blue-600 text-white shadow-lg shadow-blue-200":"bg-gray-100 text-gray-400 hover:bg-gray-200"}`,children:s},s))})]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-100",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-[10px] font-black uppercase text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Order ID"}),e.jsx("th",{className:"px-4 py-3",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3",children:"Amount"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-50",children:[f.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 font-bold text-gray-800 text-xs",children:["#",s.orderId.slice(-8)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-xs font-medium text-gray-700",children:s.vendor.name})}),e.jsxs("td",{className:"px-4 py-3 font-black text-gray-900 text-sm",children:["₦",s.escrow.amount.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[9px] font-black uppercase tracking-widest ${s.escrow.status==="released"?"bg-green-50 text-green-600":s.escrow.status==="pending"?"bg-orange-50 text-orange-600":"bg-red-50 text-red-600"}`,children:s.escrow.status})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.escrow.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>j(s._id,s.orderId),className:"px-2 py-1 text-[9px] font-black uppercase bg-green-50 text-green-600 rounded hover:bg-green-100",children:"Release"}),e.jsx("button",{onClick:()=>L(s._id,s.orderId),className:"px-2 py-1 text-[9px] font-black uppercase bg-orange-50 text-orange-600 rounded hover:bg-orange-100",children:"Hold"})]}),s.escrow.status==="held"&&e.jsx("button",{onClick:()=>j(s._id,s.orderId),className:"px-2 py-1 text-[9px] font-black uppercase bg-green-50 text-green-600 rounded hover:bg-green-100",children:"Release"})]})})]},s._id)),f.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-10 text-center text-gray-400 text-xs",children:"No transactions found matching filters"})})]})]})})]})]})]})]})}export{_ as default};
