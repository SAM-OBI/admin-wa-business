import{r as i,j as e,L as C}from"./index-Bh_G82eR.js";import{a as o}from"./admin.service-DANvCZDH.js";import{J as V,x as y,L as x,j as N,O as F,g as _}from"./index.esm-BGr2I2xK.js";import"./iconBase-D0Fi-Wjo.js";function T(){const[u,l]=i.useState([]),[v,g]=i.useState(!0),[m,w]=i.useState(""),[n,h]=i.useState({status:"",verificationStatus:""}),[r,f]=i.useState({page:1,limit:20,total:0,pages:1}),c=i.useCallback(async()=>{g(!0);try{const s=await o.getVendors({page:r.page,limit:r.limit,search:m,accountStatus:n.status,verificationStatus:n.verificationStatus});s.data&&s.data.vendors?(l(s.data.vendors),f(t=>({...t,...s.data.pagination}))):l([])}catch(s){console.error("Failed to fetch vendors:",s),l([])}finally{g(!1)}},[r.page,r.limit,m,n.status,n.verificationStatus]);i.useEffect(()=>{const s=setTimeout(()=>{c()},500);return()=>clearTimeout(s)},[c]);const j=s=>{s>=1&&s<=r.pages&&f(t=>({...t,page:s}))},S=async s=>{try{if(s.isActive){const t=prompt("Enter reason for suspension:");if(!t)return;await o.suspendVendor(s._id,t)}else await o.activateVendor(s._id);l(u.map(t=>t._id===s._id?{...t,isActive:!t.isActive}:t))}catch(t){console.error("Failed to update vendor status:",t),c()}},b=async(s,t)=>{try{let a;if(t==="rejected"&&(a=prompt("Enter reason for rejection:"),!a))return;await o.updateVendorVerification(s,t,a),c()}catch(a){console.error("Failed to update verification:",a)}},p=u,k=s=>s<30?"text-green-600 bg-green-50":s<70?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50",A=s=>{const t=(s==null?void 0:s.status)||"unverified",a={verified:"bg-green-100 text-green-700",pending:"bg-yellow-100 text-yellow-700",rejected:"bg-red-100 text-red-700",unverified:"bg-gray-100 text-gray-700",locked:"bg-orange-100 text-orange-700",failed:"bg-red-100 text-red-700"},d={verified:e.jsx(y,{className:"mr-1"}),pending:e.jsx(_,{className:"mr-1"}),rejected:e.jsx(x,{className:"mr-1"}),unverified:e.jsx(x,{className:"mr-1"}),locked:e.jsx(N,{className:"mr-1"}),failed:e.jsx(x,{className:"mr-1"})};return e.jsxs("span",{className:`inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full ${a[t]}`,children:[d[t],t]})};return v?e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Vendors Management"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Monitor vendor performance and risk"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("select",{value:n.status,onChange:s=>h(t=>({...t,status:s.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"suspended",children:"Suspended"})]}),e.jsxs("select",{value:n.verificationStatus,onChange:s=>h(t=>({...t,verificationStatus:s.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Verification"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"unverified",children:"Unverified"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search vendors...",value:m,onChange:s=>w(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-64"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Vendor Info"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Store"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Verification"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Risk Score"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[p.map(s=>{var t,a,d;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold shrink-0",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.storeName||"No Store"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Joined ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs("td",{className:"px-6 py-4",children:[A(s.verification),((t=s.verification)==null?void 0:t.status)==="pending"&&e.jsxs("div",{className:"flex gap-1 mt-2",children:[e.jsx("button",{onClick:()=>b(s._id,"verified"),className:"text-xs px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700",children:"Approve"}),e.jsx("button",{onClick:()=>b(s._id,"rejected"),className:"text-xs px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700",children:"Reject"})]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full ${s.isActive?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[s.isActive?e.jsx(y,{className:"mr-1"}):e.jsx(x,{className:"mr-1"}),s.isActive?"Active":"Suspended"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded w-fit text-sm font-medium ${k(((a=s.riskProfile)==null?void 0:a.score)||0)}`,children:[e.jsx(N,{}),((d=s.riskProfile)==null?void 0:d.score)||0,"/100"]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(C,{to:`/dashboard/vendors/${s._id}`,className:"text-blue-600 hover:text-blue-800 flex items-center gap-1 text-sm",children:["Details ",e.jsx(F,{})]}),e.jsx("button",{onClick:()=>S(s),className:`text-sm font-medium px-3 py-1 rounded-md transition ${s.isActive?"text-red-600 hover:bg-red-50":"text-green-600 hover:bg-green-50"}`,children:s.isActive?"Suspend":"Activate"})]})})]},s._id)}),p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:"No vendors found."})})]})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",e.jsx("span",{className:"font-medium",children:p.length})," of ",e.jsx("span",{className:"font-medium",children:r.total})," vendors"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j(r.page-1),disabled:r.page<=1,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700",children:["Page ",r.page," of ",r.pages]}),e.jsx("button",{onClick:()=>j(r.page+1),disabled:r.page>=r.pages,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Next"})]})]})]})]})}export{T as default};
