import{r as d,j as e,d as f}from"./index-Bh_G82eR.js";import{a as v}from"./admin.service-DANvCZDH.js";import{G as w,r as N,h as C,n as k,g as S,x as R}from"./index.esm-BGr2I2xK.js";import{S as c}from"./sweetalert2.esm.all-B3GDCxSY.js";import"./iconBase-D0Fi-Wjo.js";function E({complaint:t,onClose:x,onUpdate:h}){const[m,u]=d.useState(""),[y,l]=d.useState(!1),j=async()=>{var a,i;if(m.trim()){l(!0);try{await f.post(`/admin/complaints/${t._id}/respond`,{message:m}),c.fire({icon:"success",title:"Response Sent",text:"Your response has been added to the complaint thread",timer:2e3}),u(""),h()}catch(n){c.fire({icon:"error",title:"Error",text:((i=(a=n.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to send response"})}finally{l(!1)}}},o=async()=>{var i,n;if((await c.fire({title:"Escalate to Court Case?",text:"This will create a formal court case from this complaint",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",confirmButtonText:"Yes, Escalate"})).isConfirmed)try{await f.post(`/admin/complaints/${t._id}/escalate`),c.fire({icon:"success",title:"Escalated",text:"Court case has been created",timer:2e3}),h()}catch(s){c.fire({icon:"error",title:"Error",text:((n=(i=s.response)==null?void 0:i.data)==null?void 0:n.message)||"Failed to escalate"})}},b=async()=>{var i,n;const{value:a}=await c.fire({title:"Resolve Complaint",input:"textarea",inputLabel:"Resolution Details",inputPlaceholder:"Enter resolution details...",showCancelButton:!0,confirmButtonText:"Resolve"});if(a)try{await f.patch(`/admin/complaints/${t._id}/resolve`,{resolution:a,adminResponse:a}),c.fire({icon:"success",title:"Resolved",text:"Complaint has been marked as resolved",timer:2e3}),h()}catch(s){c.fire({icon:"error",title:"Error",text:((n=(i=s.response)==null?void 0:i.data)==null?void 0:n.message)||"Failed to resolve"})}},p=a=>{switch(a.toLowerCase()){case"high":return"bg-red-100 text-red-700";case"medium":return"bg-yellow-100 text-yellow-700";default:return"bg-green-100 text-green-700"}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${p(t.severity)}`,children:[t.severity," Severity"]}),e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-700",children:t.type.replace("_"," ")})]})]}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-100 rounded-lg transition",children:e.jsx(w,{className:"text-xl text-gray-600"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(N,{className:"text-gray-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Complainant"})]}),e.jsx("p",{className:"text-gray-700",children:t.complainant.name}),e.jsx("p",{className:"text-sm text-gray-500",children:t.complainant.email})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(N,{className:"text-gray-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Defendant"})]}),e.jsx("p",{className:"text-gray-700",children:t.defendant.name}),e.jsx("p",{className:"text-sm text-gray-500",children:t.defendant.email})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:t.description})]}),t.evidence&&t.evidence.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Evidence"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:t.evidence.map((a,i)=>e.jsx("img",{src:a,alt:`Evidence ${i+1}`,className:"w-full h-32 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-80 transition",onClick:()=>window.open(a,"_blank")},i))})]}),t.responses&&t.responses.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(C,{className:"text-gray-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Response Thread"})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:t.responses.map((a,i)=>e.jsxs("div",{className:`p-4 rounded-lg ${a.respondentType==="admin"?"bg-blue-50 ml-4":"bg-gray-50 mr-4"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.respondent.name}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:a.respondentType})]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(a.timestamp).toLocaleString()})]}),e.jsx("p",{className:"text-gray-700 text-sm",children:a.message})]},i))})]}),t.status!=="resolved"&&t.status!=="escalated_to_court"&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Add Response"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{value:m,onChange:a=>u(a.target.value),placeholder:"Type your response...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3}),e.jsx("button",{onClick:j,disabled:y||!m.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 h-fit",children:e.jsx(k,{})})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-between gap-3",children:[e.jsx("button",{onClick:x,className:"px-6 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium",children:"Close"}),e.jsx("div",{className:"flex gap-3",children:t.status!=="resolved"&&t.status!=="escalated_to_court"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:b,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium",children:"Resolve"}),e.jsx("button",{onClick:o,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium",children:"Escalate to Court"})]})})]})]})})}function D(){const[t,x]=d.useState([]),[h,m]=d.useState(!0),[u,y]=d.useState(null),[l,j]=d.useState({page:1,limit:20,total:0,pages:1}),[o,b]=d.useState({status:"",priority:""}),p=d.useCallback(async(s=1)=>{var r;m(!0);try{const g=await v.getComplaints({status:o.status,priority:o.priority,page:s,limit:l.limit});(r=g.data)!=null&&r.complaints?(x(g.data.complaints),j(g.data.pagination)):Array.isArray(g.data)?x(g.data):x([])}catch(g){console.error("Failed to fetch complaints:",g)}finally{m(!1)}},[o.status,o.priority,l.limit]);d.useEffect(()=>{p(1)},[p]);const a=s=>{s>=1&&s<=l.pages&&p(s)},i=async s=>{try{await v.resolveComplaint(s),x(t.map(r=>r._id===s?{...r,status:"resolved"}:r))}catch(r){console.error("Failed to resolve complaint:",r)}},n=async s=>{try{const r=await f.get(`/admin/complaints/${s}/details`);r.data.data&&y(r.data.data)}catch(r){console.error("Failed to fetch complaint details:",r)}};return h?e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Complaints"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Manage user issues and disputes"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("select",{value:o.status,onChange:s=>b(r=>({...r,status:s.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"escalated",children:"Escalated"})]}),e.jsxs("select",{value:o.priority,onChange:s=>b(r=>({...r,priority:s.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"All Priorities"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Issue"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Priority"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[t.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>n(s._id),children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.title}),e.jsx("div",{className:"text-sm text-gray-500 line-clamp-1",children:s.description})]}),e.jsx("td",{className:"px-6 py-4 text-gray-700",children:s.user.name}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${s.priority==="high"?"bg-red-100 text-red-700":s.priority==="medium"?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:s.priority})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="pending"&&e.jsx(S,{className:"text-yellow-500"}),s.status==="resolved"&&e.jsx(R,{className:"text-green-500"}),e.jsx("span",{className:"capitalize",children:s.status})]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:s.status!=="resolved"&&e.jsx("button",{onClick:()=>i(s._id),className:"text-green-600 hover:text-green-800 text-sm font-medium",children:"Resolve"})})]},s._id)),t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:"No complaints found."})})]})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",e.jsx("span",{className:"font-medium",children:t.length})," of ",e.jsx("span",{className:"font-medium",children:l.total})," complaints"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>a(l.page-1),disabled:l.page<=1,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700",children:["Page ",l.page," of ",l.pages]}),e.jsx("button",{onClick:()=>a(l.page+1),disabled:l.page>=l.pages,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Next"})]})]})]}),u&&e.jsx(E,{complaint:u,onClose:()=>y(null),onUpdate:()=>{y(null),p(l.page)}})]})}export{D as default};
