import{a as A,r as l,d as p,j as e}from"./index-Bh_G82eR.js";import{z as C}from"./index-B7n9UX3I.js";import{i as w,j as F}from"./index.esm-DdX2Oo8i.js";import{S as x}from"./sweetalert2.esm.all-B3GDCxSY.js";import{A as R}from"./index-DtRD-HeV.js";import{m as E}from"./proxy-B-BKHVQZ.js";import"./iconBase-D0Fi-Wjo.js";function k(i){const a=Math.floor((new Date().getTime()-i.getTime())/1e3);return a<60?"just now":a<3600?`${Math.floor(a/60)}m`:a<86400?`${Math.floor(a/3600)}h`:`${Math.floor(a/86400)}d`}function P(){var j,N;const{admin:i}=A(),[u,a]=l.useState([]),[S,m]=l.useState(!0),[d,D]=l.useState("all"),[t,n]=l.useState(null),[c,h]=l.useState(""),[M,g]=l.useState(!1);l.useEffect(()=>{f()},[]);const f=async()=>{try{m(!0);const s=await p.get("/disputes/admin/all");a(s.data.data)}catch{C.error("Failed to fetch disputes")}finally{m(!1)}},_=async s=>{if(s.preventDefault(),!(!c.trim()||!t)){g(!0);try{const r=await p.post(`/disputes/${t._id}/messages`,{message:`[ADMIN]: ${c}`});r.data.success&&(n(r.data.data),a(o=>o.map(v=>v._id===t._id?r.data.data:v)),h(""))}catch{x.fire("Error","Failed to send message","error")}finally{g(!1)}}},$=s=>s.sender===(i==null?void 0:i._id)||s.message.startsWith("[ADMIN]"),b=async(s,r)=>{try{(await p.patch(`/disputes/${s}/resolve`,{resolution:{type:r,notes:"Admin Final Decision"}})).data.success&&(x.fire("Resolved",`Dispute has been ${r}`,"success"),f(),n(null))}catch{x.fire("Error","Could not resolve dispute","error")}},y=u.filter(s=>d==="all"?!0:s.status===d);return e.jsxs("div",{className:"p-4 lg:p-6 bg-gray-50/50 min-h-screen",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-50 text-purple-600 rounded-xl shadow-sm border border-purple-100",children:e.jsx(w,{size:20})}),"Dispute Tribunal"]}),e.jsx("p",{className:"text-gray-500 mt-1 text-sm font-medium",children:"Marketplace Mediation & Resolution"})]}),e.jsx("div",{className:"flex items-center gap-2 bg-white p-1 rounded-xl border border-gray-100 shadow-sm overflow-x-auto",children:["all","open","mediation","resolved"].map(s=>e.jsx("button",{onClick:()=>D(s),className:`px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${d===s?"bg-purple-600 text-white shadow-lg shadow-purple-200":"text-gray-400 hover:text-gray-600"}`,children:s},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsx("div",{className:"xl:col-span-1 space-y-4",children:e.jsx(R,{mode:"popLayout",children:S?e.jsx("div",{className:"flex justify-center p-10",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-b-2 border-purple-600 rounded-full"})}):y.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-2xl border border-dashed border-gray-200",children:[e.jsx(F,{className:"mx-auto text-green-500 mb-4",size:40}),e.jsx("p",{className:"font-black text-gray-400 uppercase text-xs",children:"No Disputes Found"})]}):y.map(s=>{var r,o;return e.jsxs(E.div,{layout:!0,onClick:()=>n(s),className:`p-5 rounded-2xl cursor-pointer transition-all border shadow-sm group ${(t==null?void 0:t._id)===s._id?"bg-purple-600 border-purple-600 shadow-xl shadow-purple-200 text-white":"bg-white border-gray-100 hover:border-purple-200"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[9px] font-black uppercase ${(t==null?void 0:t._id)===s._id?"bg-white/20":"bg-purple-50 text-purple-600"}`,children:s.status}),e.jsxs("span",{className:"text-[10px] opacity-70",children:[k(new Date(s.updatedAt))," ago"]})]}),e.jsxs("h3",{className:"font-bold text-sm",children:["Order #",((o=(r=s.order)==null?void 0:r.orderId)==null?void 0:o.slice(-8))||"N/A"]}),e.jsx("p",{className:"text-[10px] opacity-80 mt-1 font-bold uppercase tracking-tight",children:s.reason})]},s._id)})})}),e.jsx("div",{className:"xl:col-span-2",children:t?e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 flex flex-col h-[calc(100vh-250px)]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6 pb-6 border-b border-gray-100",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold",children:["Case File: #",(N=(j=t.order)==null?void 0:j.orderId)==null?void 0:N.slice(-8)]}),e.jsxs("p",{className:"text-xs text-gray-500 font-bold uppercase mt-1",children:["Reason: ",t.reason]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(t._id,"refund"),className:"bg-red-50 text-red-600 hover:bg-red-100 text-[10px] font-black uppercase px-4 py-2 rounded-lg transition",children:"Refund Buyer"}),e.jsx("button",{onClick:()=>b(t._id,"dismissed"),className:"bg-gray-50 text-gray-600 hover:bg-gray-100 text-[10px] font-black uppercase px-4 py-2 rounded-lg transition",children:"Dismiss"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 pr-2 custom-scrollbar",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-100",children:[e.jsx("p",{className:"text-[10px] font-black text-gray-400 uppercase mb-2",children:"Buyer's Description"}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:t.description})]}),t.messages.map((s,r)=>e.jsxs("div",{className:`p-4 rounded-xl text-sm ${$(s)?"bg-purple-50 text-purple-900 ml-10":"bg-gray-100 mr-10"}`,children:[e.jsxs("p",{className:"font-bold text-[9px] uppercase opacity-50 mb-1",children:[s.senderModel||"User"," â€¢ ",k(new Date(s.timestamp))," ago"]}),e.jsx("p",{className:"text-sm",children:s.message})]},r))]}),e.jsxs("form",{onSubmit:_,className:"mt-4 flex gap-3 pt-4 border-t border-gray-100",children:[e.jsx("input",{value:c,onChange:s=>h(s.target.value),placeholder:"Enter adjudication note...",className:"flex-1 bg-gray-50 border border-gray-200 rounded-xl px-4 py-2.5 text-sm outline-none focus:ring-2 focus:ring-purple-500 transition-all"}),e.jsx("button",{type:"submit",disabled:M,className:"bg-purple-600 text-white px-6 py-2 rounded-xl text-xs font-black uppercase tracking-widest hover:bg-purple-700 disabled:opacity-50 transition-all",children:"Send"})]})]}):e.jsxs("div",{className:"h-full bg-white rounded-2xl border border-dashed flex flex-col items-center justify-center p-12 text-center",children:[e.jsx("div",{className:"p-4 bg-gray-50 rounded-full text-gray-300 mb-4",children:e.jsx(w,{size:40})}),e.jsx("h3",{className:"font-bold text-gray-400",children:"Select a case for adjudication"}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Active disputes waiting for mediator intervention will appear in the left column."})]})})]})]})}export{P as default};
