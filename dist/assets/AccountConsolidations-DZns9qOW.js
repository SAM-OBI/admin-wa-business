import{r as n,d,j as e}from"./index-Bh_G82eR.js";import{l as E,C as w,A as g,z as k,x as h,j as b,k as C,L as A}from"./index.esm-BGr2I2xK.js";import{l as S}from"./logger-kjsKaDI_.js";import{S as i}from"./sweetalert2.esm.all-B3GDCxSY.js";import"./iconBase-D0Fi-Wjo.js";function I(){const[x,f]=n.useState([]),[p,u]=n.useState(!0),[o,j]=n.useState("ALL"),l=n.useCallback(async()=>{u(!0);try{const t=await d.get("/admin/consolidation",{params:{status:o==="ALL"?void 0:o}});f(t.data.data)}catch(t){S.error("Failed to fetch consolidation requests:",t)}finally{u(!1)}},[o]);n.useEffect(()=>{l()},[l]);const y=async t=>{var s,a;const{value:c}=await i.fire({title:"Approve Consolidation",input:"textarea",inputLabel:"Justification",inputPlaceholder:"Type your justification here...",showCancelButton:!0,inputValidator:r=>r?null:"You need to provide a justification!"});if(c)try{await d.post("/admin/consolidation/approve",{requestId:t,justification:c}),i.fire("Approved","Consolidation request approved.","success"),l()}catch(r){i.fire("Error",((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Approval failed.","error")}},N=async t=>{var s,a;if((await i.fire({title:"Execute Transactional Merge?",text:"This will move all balances and assets. This action is IRREVERSIBLE.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, Execute Now!"})).isConfirmed)try{await d.post(`/admin/consolidation/${t}/execute`),i.fire("Executed","Account consolidation COMPLETED successfully.","success"),l()}catch(r){i.fire("Execution Failed",((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Transaction aborted.","error")}},v=t=>{switch(t){case"COMPLETED":return"bg-green-100 text-green-700";case"APPROVED":return"bg-blue-100 text-blue-700";case"REQUESTED":return"bg-amber-100 text-amber-700";case"FAILED":case"REJECTED":return"bg-red-100 text-red-700";case"EXECUTING":return"bg-indigo-100 text-indigo-700 animate-pulse";default:return"bg-gray-100 text-gray-700"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-black text-gray-900 flex items-center gap-2",children:[e.jsx(E,{className:"text-blue-600"}),"Account Consolidations"]}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Institutional merging of duplicate vendor identities."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:o,onChange:t=>j(t.target.value),className:"bg-white border border-gray-200 rounded-xl px-4 py-2 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500/20",children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"REQUESTED",children:"Requested"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"COMPLETED",children:"Completed"}),e.jsx("option",{value:"FAILED",children:"Failed"})]}),e.jsx("button",{onClick:l,className:"p-2 bg-white border border-gray-200 rounded-xl hover:bg-gray-50 transition-colors",children:e.jsx(w,{className:p?"animate-spin":""})})]})]}),e.jsx("div",{className:"bg-white border border-gray-100 rounded-[32px] overflow-hidden shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50/50 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Request Details"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Source Account"}),e.jsx("th",{className:"px-6 py-4 text-center text-[10px] font-black text-gray-400 uppercase tracking-widest",children:e.jsx(g,{className:"mx-auto"})}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Target Account"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-50",children:[x.map(t=>{var c,s,a,r,m;return e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs font-mono font-bold text-gray-400",children:["ID: ...",t._id.slice(-6).toUpperCase()]}),e.jsxs("span",{className:"text-[10px] text-gray-500 mt-1 flex items-center gap-1",children:[e.jsx(k,{className:"shrink-0"}),new Date(t.createdAt).toLocaleDateString()," by ",(c=t.requestedBy)==null?void 0:c.name]})]})}),e.jsx("td",{className:"px-6 py-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-black text-gray-900",children:(s=t.sourceUserId)==null?void 0:s.name}),e.jsx("span",{className:"text-xs text-gray-500",children:(a=t.sourceUserId)==null?void 0:a.email}),e.jsx("span",{className:"text-[10px] font-bold text-red-500 mt-1 uppercase",children:"Source (To be closed)"})]})}),e.jsx("td",{className:"px-6 py-6 text-center",children:e.jsx(g,{className:"mx-auto text-gray-300"})}),e.jsx("td",{className:"px-6 py-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-black text-gray-900",children:(r=t.targetUserId)==null?void 0:r.name}),e.jsx("span",{className:"text-xs text-gray-500",children:(m=t.targetUserId)==null?void 0:m.email}),e.jsx("span",{className:"text-[10px] font-bold text-green-600 mt-1 uppercase",children:"Target (Survivor)"})]})}),e.jsx("td",{className:"px-6 py-6",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-wider ${v(t.status)}`,children:t.status})}),e.jsx("td",{className:"px-6 py-6 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[t.status==="REQUESTED"&&e.jsxs("button",{onClick:()=>y(t._id),className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 text-white rounded-lg text-xs font-bold hover:bg-blue-700 transition",children:[e.jsx(h,{size:14})," Approve"]}),t.status==="APPROVED"&&e.jsxs("button",{onClick:()=>N(t._id),className:"flex items-center gap-1.5 px-3 py-1.5 bg-green-600 text-white rounded-lg text-xs font-bold hover:bg-green-700 transition",children:[e.jsx(b,{size:14})," Execute Merge"]}),(t.status==="COMPLETED"||t.status==="FAILED")&&e.jsx("button",{onClick:()=>i.fire("Execution Forensic",`Checksum: ${t.executionChecksum||"N/A"}
Executed At: ${t.executedAt?new Date(t.executedAt).toLocaleString():"N/A"}`,"info"),className:"p-2 border border-gray-200 rounded-lg text-gray-500 hover:bg-gray-50",title:"View Forensic Data",children:e.jsx(C,{size:16})})]})})]},t._id)}),x.length===0&&!p&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-20 text-center text-gray-400 italic",children:"No consolidation requests found."})})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-blue-50/50 border border-blue-100 p-6 rounded-[32px] space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-blue-700",children:[e.jsx(b,{className:"text-xl"}),e.jsx("h3",{className:"font-black text-sm uppercase tracking-widest",children:"Dual-Control Policy"})]}),e.jsx("p",{className:"text-xs text-blue-800 leading-relaxed opacity-80",children:"High-value accounts require multiple administrator approvals. The executor cannot be the same person who requested the consolidation."})]}),e.jsxs("div",{className:"bg-green-50/50 border border-green-100 p-6 rounded-[32px] space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-green-700",children:[e.jsx(h,{className:"text-xl"}),e.jsx("h3",{className:"font-black text-sm uppercase tracking-widest",children:"Transactional Safety"})]}),e.jsxs("p",{className:"text-xs text-green-800 leading-relaxed opacity-80",children:["All merges use ",e.jsx("strong",{children:"SNAPSHOT"})," isolation with distributed locks. Balances are migrated via append-only ledger entries with zero-drift verification."]})]}),e.jsxs("div",{className:"bg-amber-50/50 border border-amber-100 p-6 rounded-[32px] space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-amber-700",children:[e.jsx(A,{className:"text-xl"}),e.jsx("h3",{className:"font-black text-sm uppercase tracking-widest",children:"Irreversibility"})]}),e.jsx("p",{className:"text-xs text-amber-800 leading-relaxed opacity-80",children:"Once a consolidation is executed, PII is scrubbed from the source account and it is permanently deactivated. Recovery is only possible via forensic backups."})]})]})]})}export{I as default};
